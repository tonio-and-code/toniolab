# 単語復習システム マスター仕様書

## 概要

15,000以上の単語 x 各1つのユニークなイディオム = 15,000個のイディオムを自然な文脈で習得。
1日10語、1シナリオ50語（= 5日分）でカレンダー表示。約1,500日（約4年）で全語完了。
各単語に対して1つの例文を用意する:
1. ターゲット単語（自然に使う）
2. ボーナスイディオム（全15,000語で絶対に重複しない）
3. その日のシナリオに合った生活シチュエーション

---

## スタイルルール（絶対厳守）

### スピーキング専用システム
- 全ての例文は「実際に人が口に出して言う台詞」であること
- 一人称（I, we）、二人称（you）、または誰かの発言の引用
- 直接的な発言、リアクション、愚痴、友達に話すストーリー
- ナレーション禁止。描写禁止。三人称の文章禁止。
- 基準：「この状況で、人が実際に口に出して言うこと」

### ダメな例（ナレーション・描写 = 禁止）:
- "He walked to the store and bought some milk."
- "The storm destroyed their sandcastle on the beach."
- "She felt nervous before the interview."

### 良い例（実際の発話）:
- "I literally just walked to the store and forgot my wallet. Classic me."
- "Dude, the storm totally destroyed our sandcastle. I was so bummed."
- "OK so I'm freaking out 'cause my interview is in like an hour."

### 口語英語ルール
- 短縮形を必ず使う: I'm, don't, can't, wouldn't, gonna, wanna, gotta, kinda, sorta
- 断片文OK: "Such a pain." "No way." "Totally worth it."
- フィラー自然に入れる: "like", "honestly", "I mean", "you know"
- カジュアルな接続: "so", "and then", "but like", "anyway"
- リアルなリアクション: "Dude," "Oh my god," "Wait, what?" "No joke,"
- スラングや略語: "lowkey", "the GOAT", "ngl", "tbh", "fr"

### 文法は崩してOK（むしろ崩すべき）
実際の話し言葉は文法通りではない。以下を積極的に使う:
- g-dropping: "I'm thinkin'", "we're goin'", "he's workin'", "nothin'", "somethin'"
- 主語省略: "Gotta go." "Can't believe it." "Dunno."
- 文法的に「正しくない」表現: "me and my friend went...", "there's like three of them"
- 途中で言い直し: "I was gonna-- well, actually I ended up just..."
- 二重否定もOK: "I don't know nothin' about that"
- 文末の確認: "...right?", "...you know?", "...isn't it?"
- リアルな発音反映: "'cause" (because), "'em" (them), "y'all", "lemme", "gimme"

### 話者の明示ルール（絶対必須）
- 各文は**誰が話しているか明確**でなければならない
- プロローグで定義したキャラクターの台詞として書く
- キャラの性格・年齢・職業が台詞に自然に反映されること
- シードスクリプトにも `speaker` フィールドを含めること（誰の台詞か記録）
- 例:
  - Tommy(gym bro): "Bro your handshake is so wimpy" → Tommyの口調とわかる
  - Mrs. Brenda(55F,先生): "You kids have no idea -- back in my day..." → 年配の先生とわかる
  - Stacy(gossip queen): "OK I was about to spill some MAJOR tea..." → ゴシップ好きとわかる
  - Hiro(quiet PhD): 短くて皮肉な一言 → 静かな知性派とわかる

### 避けること
- フォーマル・アカデミックな文構造
- 文学的な描写
- 三人称ナレーション（"He did X", "She went to Y"）
- 教科書っぽい言い回し
- エッセイや小説に出てきそうな文
- イディオムの不自然な詰め込み
- **文法的に正しすぎる英語**（実際の会話ではない）
- **誰が話しているかわからない文**

### チェック基準:
1. 実際の人間がこの文を友達に口頭で言うか？ → 言わないなら書き直し
2. この台詞を読んで、どんな人が話しているか想像できるか？ → できないなら書き直し
3. 文法的に教科書通りすぎないか？ → 崩せるところは崩す

---

## 年齢・性別・視点ルール

### 各日50文の中でランダムに混ぜる:
- 年齢: 子供、10代、20代、30代、40代以上、高齢者をミックス
- 性別: he/she/they、彼氏/彼女、お母さん/お父さん、夫/妻
- 視点: 自分（I）、友達の発言引用、親の発言引用、誰かの話をしている
- 名前: 多様な名前を使う（Jake, Mia, Kenji, Priya, Marcus, Lily等）

### 1日の中での視点バリエーション例:
- "I literally can't believe I failed that test."（自分、10代）
- "My mom always says 'back in my day' and I'm like OK boomer."（親の引用、10代）
- "So Jake told me he got fired and I'm like WHAT."（友達の引用、20代）
- "My daughter just said her first word and I almost cried."（親視点、30代）
- "Grandpa keeps telling me the same war story every Thanksgiving."（祖父について）

---

## シナリオ配置ルール

### 時系列でまとめない！
- ダメ: Day 1-40 = 全部赤ちゃん、Day 41-100 = 全部小学校
- 良い: 毎月ランダムミックス。Day 1 = 就職面接、Day 2 = 公園遊び、Day 3 = 定年退職

### 各月で全ライフステージからランダムに混ぜる
- 幼児期シナリオ
- 学童期シナリオ
- 10代シナリオ
- 大学シナリオ
- キャリアシナリオ
- 家庭・子育てシナリオ
- 中高年シナリオ

---

## デイプロローグシステム

各日のプロローグは `src/data/english/day-prologues.ts` に格納:

```typescript
export interface DayPrologue {
    title: string;        // 英語タイトル
    titleJa: string;      // 日本語タイトル（年齢・性別付き）
    setting: string;      // 英語のシーン説明
    settingJa: string;    // 日本語のシーン説明
    characters: { name: string; desc: string }[];  // キャスト一覧
}
```

### プロローグ作成ガイドライン:
- タイトルは3-6語でシナリオを表現
- titleJaには年齢と性別を含める: 例「高校初日（15歳、男）」
- 設定: 2-3文でシーンを描写。個性とユーモアを入れる
- キャラクター: 1日3-10人、名前（年齢/性別）と一行の性格描写
- キャラクターは多様で記憶に残りやすく、それぞれ独自の声を持つ
- その日の50文はこれらのキャラクターを参照する

### 現在定義済みのプロローグ:
- 2026-01-01: Baby's First Words（Scenario 001, words 0-49）
- 2026-02-05: College Party（Scenario 008, words 350-399）
- 2026-06-25: First Day of High School（Scenario 036, words 1750-1799）
- 2026-06-30: Baby Shower（Scenario 037, words 1800-1849）
- 2026-07-05: Class Reunion（Scenario 038, words 1850-1899）
- 2026-07-10: First Salary Negotiation（Scenario 039, words 1900-1949）

---

## 単語の意味チェック（必須）

### 例文生成時に必ず確認すること:
- その日の50語全ての `meaning`（意味）フィールドを確認
- 意味が空（NULL/空文字）の単語 → 正しい意味を調べて登録する
- 意味がおかしい・間違っている単語 → 正しい意味に修正する
- 意味のフォーマット: 日本語で簡潔に（例: "頑固な"、"飛び込み営業する"）

### 修正方法:
- シードスクリプト内で `meaning` フィールドも一緒に更新する
- または別途 SQL/API で `user_phrases` テーブルの `meaning` カラムを更新

### 背景:
- 全15,152語のうち約3,900語の意味が未登録（初期の一括インポート時の問題）
- 新しいDay（036以降）の単語は問題なし
- 古いDay（001-035）の単語は要チェック

---

## シナリオカレンダー

### 日付とDay番号の対応
- Day 001 = 2026-01-01
- Day 032 = 2026-02-01
- Day 060 = 2026-03-01
- 1日 = 10語（単語インデックス: day * 10）
- 1シナリオ = 50語 = 5日分（プロローグは5日間共有）
- 全15,000語 = 約1,500日 = 2026-01-01 ~ 約2030年

### 1月（Day 001-031）

| Day | 日付 | シナリオ |
|-----|------|----------|
| 001 | 01-01 | 赤ちゃんの初めての言葉（0-2歳、親目線30代） |
| 002 | 01-02 | 大卒後の初めての就職面接（22歳、男） |
| 003 | 01-03 | ハロウィンのトリックオアトリート（8歳、女） |
| 004 | 01-04 | プロポーズ（29歳、男） |
| 005 | 01-05 | 中学のダンスパーティー（13歳、女） |
| 006 | 01-06 | 定年退職の最終日（62歳、男） |
| 007 | 01-07 | 補助輪なしで自転車（6歳、親目線） |
| 008 | 01-08 | 大学のパーティー（20歳、男） |
| 009 | 01-09 | 仕事で新しい街に引っ越し（26歳、女） |
| 010 | 01-10 | 嫌な先生への対処（14歳、男） |
| 011 | 01-11 | 結婚式の準備ストレス（31歳、女） |
| 012 | 01-12 | 初めての飛行機（10歳、女） |
| 013 | 01-13 | クォーターライフクライシス（25歳、男） |
| 014 | 01-14 | ごっこ遊び（4歳、女） |
| 015 | 01-15 | SAT/ACT受験ストレス（17歳、男） |
| 016 | 01-16 | 新生児との最初の1週間（33歳、女） |
| 017 | 01-17 | 運転免許取得（16歳、男） |
| 018 | 01-18 | 子供が大学に行って空の巣（50歳、女） |
| 019 | 01-19 | 雪の日、学校休み！（9歳、男） |
| 020 | 01-20 | インターンシップ探し（21歳、女） |
| 021 | 01-21 | 高齢の親の世話（38歳、男） |
| 022 | 01-22 | 初恋、小学生バージョン（11歳、男） |
| 023 | 01-23 | 卒業後の友達とロードトリップ（18歳、グループ） |
| 024 | 01-24 | 祖父母になる（58歳、女） |
| 025 | 01-25 | 仲間からの圧力（13歳、男） |
| 026 | 01-26 | 家を買う（34歳、女） |
| 027 | 01-27 | 初バイト、ファストフードか小売（16歳、女） |
| 028 | 01-28 | 祖父母の家を訪問（7歳、男） |
| 029 | 01-29 | 仕事の燃え尽き症候群（28歳、女） |
| 030 | 01-30 | プロム（17歳、混合） |
| 031 | 01-31 | 子供に自転車を教える（36歳、父親） |

### 2月（Day 032-059）

| Day | 日付 | シナリオ |
|-----|------|----------|
| 032 | 02-01 | 歯列矯正（12歳、女） |
| 033 | 02-02 | 初めての本気の恋愛（24歳、男） |
| 034 | 02-03 | 家族ロードトリップ「まだ着かないの？」（5歳、子供目線） |
| 035 | 02-04 | 親を亡くす（45歳、女） |
| 036 | 02-05 | 高校初日（15歳、男） |
| 037 | 02-06 | ベビーシャワー（30歳、女） |
| 038 | 02-07 | サマーキャンプ（10歳、男） |
| 039 | 02-08 | 初めての給料交渉（23歳、女） |
| 040 | 02-09 | 暗闇が怖い、ベッドの下のモンスター（4歳、男） |
| 041 | 02-10 | 高校の同窓会（38歳、男） |
| 042 | 02-11 | 親なしで初めて映画館（12歳、グループ） |
| 043 | 02-12 | 学生ローンの返済（25歳、女） |
| 044 | 02-13 | クリスマス、欲しいものリスト（8歳、女） |
| 045 | 02-14 | 大学卒業式（22歳、男） |
| 046 | 02-15 | 子供のスポーツチームのコーチ（37歳、男） |
| 047 | 02-16 | 初めてのベビーシッター（14歳、女） |
| 048 | 02-17 | 大卒後一時的に実家に戻る（23歳、男） |
| 049 | 02-18 | 学校の理科フェア（11歳、女） |
| 050 | 02-19 | デートナイト、やっとベビーシッター確保（34歳、夫婦） |
| 051 | 02-20 | テストでカンニングがバレた（15歳、男） |
| 052 | 02-21 | バケットリスト旅行（55歳、夫婦） |
| 053 | 02-22 | スーパーで癇癪（3歳、親目線28歳女） |
| 054 | 02-23 | 初めての一人暮らし（24歳、女） |
| 055 | 02-24 | 三者面談（35歳、母親） |
| 056 | 02-25 | シニアイティス、学校どうでもいい（18歳、女） |
| 057 | 02-26 | 趣味の再発見（48歳、男） |
| 058 | 02-27 | 初めての公園、滑り台とブランコ（3歳、親目線） |
| 059 | 02-28 | ブラックフライデー買い物狂騒（27歳、女） |

### 3月以降
残り306日も同じランダム配置パターンで生成。365シナリオプールから全8ライフフェーズをシャッフルして割り当てる。

---

## イディオム管理ルール

- 日常会話で実際に使われるものだけ
- 古語や文語専用のイディオムは禁止
- 2025年現在で人が実際に使うイディオムを優先
- 句動詞、スラング表現、口語表現も含む
- **全15,000語で絶対に重複禁止**
- 生成前に `scripts/used-idioms.json` を確認
- 生成後に `scripts/used-idioms.json` に追加
- イディオム一覧は `/english/idiom-list` で確認可能

### 現在の状況:
- 約343イディオム使用済み（Scenario 001, 008, 036, 037, 038, 039, 040）
- 残り約14,650スロット

---

## コンテンツ品質ガイドライン

### 1シナリオ（50語 = 5日分）で「物語」を作る（最重要）
- 50文はバラバラの文ではなく、**シナリオの一晩/一日を描くストーリー**にする
- 1シナリオ = 50語 = カレンダー5日分を一括生成（1日10語だが、生成単位はシナリオ）
- 複数キャラの視点から同じ出来事を語ることで、立体的な物語になる
- サブプロットを2-3本走らせる:
  - メイン: 主人公の課題/目標（Tyler→Alyssaへの告白、Maya→昇給交渉）
  - サブ1: キャラ間の対立（Derek vs Jake のAUX戦争）
  - サブ2: 外部からの圧力（Professor Hayes の苦情エスカレーション）
- 同じキャラの台詞が後半で前半の出来事を参照すると自然な流れになる

### 難しい単語の自然な埋め込みテクニック
シナリオに合わない技術用語・専門用語の処理法:
- **授業の話を持ち出す**: "I learned about [term] in biology class..." (zygote, coefficient of restitution)
- **誤用・素人的な使い方**: Jake が habeas corpus をパーティーの文脈で間違って使う
- **環境の小道具**: 棚のフクロウの剥製 → taxidermist の話題に
- **比喩・冗談として**: "we're like stationary troops guarding the beer pong table"
- **別の会話からの脱線**: "OK random but..." で唐突に別トピックを入れる

### キャラの声の分離ルール
各キャラが「誰の台詞かわかる」ために:
- **口癖を決める**: Brandon = "bro/dude", Zoe = "content/followers/viral"
- **文の長さで性格を出す**: 内向的キャラ = 長めの内省、パーティー系 = 短い断言
- **知識レベルの差**: Kenji = 文化比較、Professor Hayes = アカデミック語彙
- **態度の一貫性**: Rosa = 常にドライで批判的、Brandon = 常に楽観的

### イディオムの戦略的組み合わせ
- **皮肉・逆説**: introvert + "in one's element"（内向型が水を得た魚？）
- **キャラ性格に合致**: Rosa(責任感) + "get a grip", "party pooper"
- **状況に直結**: fisticuffs + "put on a brave face"（殴り合い→強がり）
- **テーマ強化**: 全体のテーマ（パーティー）に合うイディオムを多めに選ぶ

### 意味（meaning）修正パターン
よくある問題と修正方法:
- **例文が入っている**: "How did you misconstrue..." → "誤解する・曲解する" に修正
- **英語のみ**: "bad-tempered" → "無愛想な・不機嫌な" に日本語化
- **タイポ**: "grrison" → "駐屯部隊（garrison）"
- **雑な羅列**: "dinero, dough," → "金・金銭（filthy lucre = 不正な金）"
- **空欄**: 正しい日本語訳を調べて入力

---

## 生成ワークフロー

### 1シナリオ分の生成手順（必ず3点セットで生成）:

**Word Review + Memoria + Expressions は常にセット。どれか一つだけ生成はNG。**

#### A. Word Review（50語の例文 + イディオム）
1. `scripts/used-idioms.json` で使用済みイディオムを確認
2. この仕様書でその日のシナリオ（年齢、性別、状況）を確認
3. `src/data/english/day-prologues.ts` でその日のプロローグを確認/作成
4. **その日の50語の意味（meaning）を全チェック** → 空や間違いがあれば修正
5. 50語それぞれについて:
   a. 新しいイディオムを選ぶ（使用済みリストにないもの）
   b. 単語+イディオムを使ったスピーキング用の文を書く
   c. 年齢/性別/視点をその日の中でランダムに変える
   d. 超カジュアル、リアルな口語英語を維持
   e. 日本語訳を含める（sentence_ja + idiom_meaning）
6. 50個の新しいイディオムを `scripts/used-idioms.json` に追加
7. シードスクリプトを `scripts/seed-dayXXX-sentences.mjs` に作成
8. シードスクリプトを実行してDBに投入

#### B. Memoria（5日分の会話コンテンツ）

**必読: `docs/memoria-speech-spec.md` -- 表層ルールだけでは不十分。構造的な7つのルールを必ず適用すること。**

対話は「覚える価値のある英語」でなければならない。表面的にg-droppingやfillerを散りばめただけの「装飾された台本」は禁止。以下の構造が必須:
- 情報密度: 1発話の60%以上がfunction words（フィラー、繰り返し、足場）
- 認知マーカー: 5-8行ごとにum/uh/言い直し/self-correctionが最低1回
- Clause chain: 発話の30%以上が接着剤（and/but/so/I mean）で4+回方向転換
- g-dropping変動: 70-80%（100%一律は不自然）
- ターン長の変動: 20%以上が短い(1-5語)、20%以上が長い(50語+)
- 繰り返し: 重要ポイントは2-3回言い換えて着地
- Cross-turn: 20%以上のターンが直前の発言を参照

生成手順:
1. `src/data/english/` に会話データファイルを作成（例: `monster-under-bed.ts`）
2. 各日30-40行程度の対話（英語 + 日本語）、全キャラクターが登場
3. `docs/memoria-speech-spec.md` のQuality Checklistで全7項目を検証
4. `src/app/memoria/page.tsx` にインポート追加
5. `src/app/memoria/[id]/page.tsx` にインポート + キャラクターカラー + ID prefix handler追加
6. カレンダーに正しい日付で表示されることを確認

#### C. Expressions（75個のスラング表現集）
1. `src/data/english/` に表現データファイルを作成（例: `monster-expressions.ts`）
2. 15表現/日 x 5日 = 75表現、各キャラクターの声を反映
3. `src/app/english/expressions/page.tsx` に統合
4. 各表現にspeaker, example, 日本語/英語meaningを含める
5. used-idioms.jsonとの重複チェック（expressionsはスラング/口語、idiomsと別管理）

### シードスクリプトのフォーマット:
```javascript
// scripts/seed-dayXXX-sentences.mjs
const DAYXXX_DATA = [
    {
        id: 'wordId',        // user_phrasesテーブルのID
        speaker: "Name",     // 誰の台詞か（プロローグのキャラ名）
        sentence: "...",      // 英語の例文（その人が実際に口に出す台詞）
        sentence_ja: "...",   // 日本語訳
        idiom: "...",         // 使用したイディオム
        idiom_meaning: "..."  // イディオムの意味（英語 / 日本語）
    },
    // ... 50エントリ
];
```

### 更新するDBフィールド:
- `review_sentence` - 英語の例文
- `review_sentence_ja` - 日本語訳
- `review_idiom` - 使用したイディオム
- `review_idiom_meaning` - イディオムの意味（英語 / 日本語）
- `meaning` - 単語の意味（空や間違いがあれば修正）

---

## ファイル配置

| ファイル | 用途 |
|---------|------|
| `docs/word-review-spec.md` | このファイル（マスター仕様書） |
| `src/data/english/day-prologues.ts` | デイプロローグ（キャラクター、設定） |
| `scripts/used-idioms.json` | 使用済みイディオム管理（重複禁止） |
| `scripts/seed-dayXXX-sentences.mjs` | 日別シードスクリプト |
| `src/app/english/word-review/page.tsx` | 単語復習カレンダーページ |
| `src/app/english/word-review/[date]/page.tsx` | 単語復習日別ページ（プレイヤー） |
| `src/data/english/*-recap.ts` / `*-under-bed.ts` | Memoria会話データ（シナリオ別） |
| `src/data/english/*-expressions.ts` | スラング表現集（シナリオ別、15/日x5日=75） |
| `src/app/memoria/page.tsx` | Memoriaカレンダー（全シリーズ統合） |
| `src/app/memoria/[id]/page.tsx` | Memoria詳細ページ（会話プレイヤー） |
| `src/app/english/expressions/page.tsx` | スラング表現集ページ |

---

## 進捗トラッカー

| Day | 日付 | シナリオ | プロローグ | 例文 | イディオム | Memoria | Expressions |
|-----|------|----------|-----------|------|-----------|---------|-------------|
| 001 | 01-01 | 赤ちゃんの初めての言葉 | 済 | 済 | 済 | -- | -- |
| 002-007 | 01-02 ~ 01-07 | 各種 | -- | -- | -- | -- | -- |
| 008 | 01-08 | 大学のパーティー | 済 | 済 | 済 | 済 | 済 |
| 009-035 | 01-09 ~ 02-04 | 各種 | -- | -- | -- | -- | -- |
| 036 | 02-05 | 高校初日 | 済 | 済 | 済 | -- | -- |
| 037 | 02-06 | ベビーシャワー | 済 | 済 | 済 | -- | -- |
| 038 | 02-07 | 同窓会 | 済 | 済 | 済 | -- | -- |
| 039 | 02-08 | 初めての給料交渉 | 済 | 済 | 済 | -- | -- |
| 040 | 02-10 | 暗闇が怖い、ベッドの下のモンスター | 済 | 済 | 済 | 済 | 済 |
| 041-059 | 02-15 ~ 02-28 | 各種 | -- | -- | -- | -- | -- |

**次に生成するもの**: Day 041
**注意**: Word Review + Memoria + Expressions は常に3点セットで生成すること
